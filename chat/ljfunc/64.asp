<%'氣功師
function qigongshi()
Set rs=Server.CreateObject("ADODB.RecordSet")
Set Conn=Server.CreateObject("ADODB.Connection")
conn.open Application("ljjh_usermdb")
rs.open "select 等級,職業,內力,體力,內力加,體力加,會員等級,操作時間 FROM 用戶 WHERE id="&info(9),conn
if left(rs("職業"),3)<>"水法師" and left(rs("職業"),3)<>"水真人" and left(rs("職業"),3)<>"水天師" then
rs.close
	set rs=nothing	
	conn.close
	set conn=nothing
Response.Write "<script language=JavaScript>{alert('你的職業還不是水法師、水真人、水天師怎麼補氣！');}</script>"
Response.End
end if  
if rs("體力")<1000 then
rs.close
	set rs=nothing	
	conn.close
	set conn=nothing
Response.Write "<script language=JavaScript>{alert('你的體力小於1000，無法治療！');}</script>"
Response.End
end if
if rs("等級")<40 then
rs.close
	set rs=nothing	
	conn.close
	set conn=nothing
Response.Write "<script language=JavaScript>{alert('你的等級小於40，無法治療！');}</script>"
Response.End
end if
sj=DateDiff("s",rs("操作時間"),now())
if sj<6 then
	rs.close
	set rs=nothing	
	conn.close
	set conn=nothing
	ss=6-sj
	Response.Write "<script language=JavaScript>{alert('請你等上["& ss &"]秒,再操作！');}</script>"
	Response.End
end if
if rs("會員等級")>0 then 
 hy=1
else
 hy=0
 end if
nl=rs("內力")
tlj=(rs("等級")*1500+5260)+rs("體力加")
nlj=(rs("等級")*640+2000)+rs("內力加")
if rs("內力")>=nlj then
rs.close
	set rs=nothing	
	conn.close
	set conn=nothing
Response.Write "<script language=JavaScript>{alert('你現在身體好好的，不需要你的治療啊！');}</script>"
Response.End
end if
if hy=1 then 
 butl=nlj-nl
 blsq=1000
 else
 butl=nlj-nl
 blsq=5000
end if
conn.execute "update 用戶 set 內力=內力+"&butl&",體力=體力-"&blsq&",操作時間=now() where id="&info(9)
if rs("內力")>nlj then
conn.execute "update 用戶 set 內力=" & nlj & " where id="&info(9)
end if
if rs("體力")<0 then
conn.execute "update 用戶 set 體力=100 where id="&info(9)
end if
qigongshi="氣功大師"&info(0)& "對自己使用了治療術，"&info(0)&"的內力迅速恢復"& butl &"點!"&info(0)&"損耗"&blsq&"的體力！"
rs.close
conn.close
set rs=nothing	
set conn=nothing
end function
%>
